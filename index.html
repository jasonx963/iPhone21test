<!DOCTYPE html>
<html lang="es-MX">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>iPhone 16 / Pro / Pro Max – Tienda</title>
  <meta name="description" content="Compra iPhone 16 / Pro / Pro Max con experiencia de tienda limpia y rápida.">
  <style>
    /* ===== Apple-like minimal style (原创) ===== */
    :root{
      --bg:#fff;--text:#111;--muted:#666;--border:#e5e5e5;--tile:#f5f5f7;
      --accent:#111;--accent-weak:#2b2b2b;--cta:#0071e3;--cta-ink:#fff;
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    a{color:inherit;text-decoration:none}

    /* 顶部导航（简洁、留白） */
    .nav{position:sticky;top:0;z-index:10;background:rgba(255,255,255,.8);backdrop-filter:saturate(180%) blur(12px);border-bottom:1px solid var(--border)}
    .nav .bar{max-width:1140px;margin:0 auto;padding:10px 16px;display:flex;align-items:center;gap:18px}
    .brand{font-weight:800;letter-spacing:.2px}
    .nav-links{display:flex;gap:16px;color:#555;font-weight:600;font-size:14px}
    .nav-right{margin-left:auto;display:flex;gap:12px;align-items:center}
    .pill{background:#f2f2f2;border:1px solid var(--border);border-radius:999px;padding:8px 12px;font-weight:700;cursor:pointer}
    .bag{position:relative;padding:8px 10px;border-radius:999px;border:1px solid var(--border);background:#fafafa}
    .bag::after{content:attr(data-count);position:absolute;top:-6px;right:-6px;background:#111;color:#fff;font-size:11px;line-height:1;padding:4px 6px;border-radius:999px;display:none}
    .bag[data-count]:not([data-count="0"])::after{display:inline-block}

    /* Hero */
    .hero{max-width:1140px;margin:0 auto;padding:32px 16px 16px;display:grid;grid-template-columns:1.1fr .9fr;gap:28px}
    @media(max-width:960px){.hero{grid-template-columns:1fr}}
    .h-title{font-size:44px;line-height:1.08;margin:0 0 8px;font-weight:900;letter-spacing:-.5px}
    .h-sub{font-size:18px;color:#444;margin:0 0 16px}
    .hero-cta{display:flex;gap:10px;flex-wrap:wrap}
    .btn{border:0;border-radius:12px;padding:12px 16px;font-weight:800;cursor:pointer}
    .btn.dark{background:var(--accent);color:#fff}
    .btn.light{background:#f2f2f2;color:#111;border:1px solid var(--border)}
    .tile-hero{background:var(--tile);border-radius:20px;display:flex;align-items:center;justify-content:center;min-height:260px;overflow:hidden}
    .tile-hero img{width:100%;height:auto;object-fit:contain}

    /* 倒计时（不重叠：行内块+固定最小宽高） */
    .count{display:flex;align-items:center;gap:10px;margin-top:14px}
    .chip{display:inline-flex;align-items:center;justify-content:center;min-width:54px;height:48px;border-radius:12px;background:#111;color:#fff;font-weight:900;font-size:24px}
    .sep{font-size:24px;font-weight:900}

    /* 产品宫格 */
    .wrap{max-width:1140px;margin:0 auto;padding:16px}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:20px}
    @media(max-width:960px){.grid{grid-template-columns:1fr}}
    .card{background:#fff;border:1px solid var(--border);border-radius:22px;overflow:hidden;box-shadow:0 6px 20px rgba(0,0,0,.05)}
    .ph{background:var(--tile);padding:18px;display:flex;align-items:center;justify-content:center}
    .ph img{width:100%;max-height:280px;object-fit:contain}
    .ct{padding:16px 16px 18px}
    .ttl{font-weight:900;font-size:18px;margin:4px 0 6px}
    .muted{color:var(--muted);font-size:13px}
    .price{display:flex;align-items:flex-end;gap:12px;margin:12px 0}
    .p-new{font-size:26px;font-weight:900}
    .p-old{text-decoration:line-through;color:#888}
    .badge{background:#111;color:#fff;border-radius:999px;padding:4px 8px;font-size:12px;font-weight:800}

    .opt-label{font-size:12px;font-weight:800;margin:10px 0 6px;color:#333}
    .opt-row{display:flex;gap:8px;flex-wrap:wrap}
    .opt{border:1px solid var(--border);background:#fafafa;border-radius:999px;padding:8px 10px;font-weight:700;cursor:pointer}
    .opt.active{background:#111;color:#fff;border-color:#111}
    .dots{display:flex;gap:6px;margin-top:8px}
    .dot{width:18px;height:18px;border-radius:50%;border:1px solid rgba(0,0,0,.2);cursor:pointer}
    .dot[data-color="Negro"]{background:#000}
    .dot[data-color="Blanco"]{background:#fff}
    .dot[data-color="Azul"]{background:#cfe3ff}
    .dot[data-color="Dorado"]{background:#f7e7b4}
    .dot[data-color="Rojo"]{background:#ff4d4d}
    .dot.active{outline:2px solid #111;outline-offset:2px}

    .actions{display:flex;gap:10px;margin-top:12px}
    .buy{background:var(--cta);color:var(--cta-ink)}
    .ghost{background:#f2f2f2;border:1px solid var(--border);color:#111}

    /* 轻提示条（替代之前巨幅跑马灯，仍兼容 /api/feed） */
    .ticker{border-top:1px solid var(--border);border-bottom:1px solid var(--border);background:#fafafa}
    .ticker .bar{max-width:1140px;margin:0 auto;padding:8px 16px;color:#444;font-weight:700;white-space:nowrap;overflow:hidden}
    #tickerText{display:inline-block;will-change:transform}

    /* WhatsApp 小悬浮 */
    .wa{position:fixed;right:16px;bottom:16px;background:#25D366;color:#fff;padding:12px 14px;border-radius:999px;font-weight:900;box-shadow:0 10px 30px rgba(0,0,0,.2);cursor:pointer;z-index:10}
  </style>
</head>
<body>
  <!-- 顶部导航 -->
  <nav class="nav">
    <div class="bar">
      <div class="brand">KAI BO</div>
      <div class="nav-links">
        <a href="#">Inicio</a>
        <a href="#">Tienda</a>
        <a href="#">Soporte</a>
      </div>
      <div class="nav-right">
        <button class="pill" id="btnCentro">Orden</button>
        <button class="pill" id="btnTopWA">Contáctenos</button>
        <div class="bag" id="bag" data-count="0" title="Bolsa"></div>
      </div>
    </div>
  </nav>

  <!-- Hero -->
  <section class="hero">
    <div>
      <h1 class="h-title">iPhone 16 / Pro / Pro Max</h1>
      <p class="h-sub">Rápido. Elegante. Poderoso. Compra con una experiencia limpia y segura.</p>
      <div class="hero-cta">
        <button class="btn dark" id="btnShop">Comprar ahora</button>
        <button class="btn light" id="btnBottomWA2">Hablar por WhatsApp</button>
      </div>
      <!-- 简洁倒计时：不重叠 -->
      <div class="count" aria-label="Oferta cuenta atrás">
        <div class="chip" id="h">00</div><div class="sep">:</div>
        <div class="chip" id="m">00</div><div class="sep">:</div>
        <div class="chip" id="s">00</div>
      </div>
    </div>
    <div class="tile-hero">
      <img src="images/16pro.png" alt="iPhone 16 Pro visual" />
    </div>
  </section>

  <!-- 轻量 ticker（可拉取 /api/feed） -->
  <div class="ticker"><div class="bar"><span id="tickerText">Cargando últimas compras…</span></div></div>

  <!-- 产品宫格 -->
  <main class="wrap">
    <section class="grid" id="grid"></section>
  </main>

  <!-- WhatsApp 悬浮 -->
  <button class="wa" id="btnWA">WhatsApp</button>

  <script>
    /* ===== 配置与数据 ===== */
    const DISCOUNT = 0.85; // 15% OFF（实付85%）
    const CURRENCY = 'MX$';
    const PAYMENT_URL = 'payment.html';
    const WHATSAPP_URL = 'https://lihi.vip/t4sPq';

    const productos = [
      {
        id:'ip16', nombre:'iPhone 16',
        precioOriginal:{'128GB':19999,'256GB':22499,'512GB':27499},
        opciones:{ almacenamiento:['128GB','256GB','512GB'], color:['Negro','Blanco','Azul'] },
        img:'images/16.png'
      },
      {
        id:'ip16pro', nombre:'iPhone 16 Pro',
        precioOriginal:{'128GB':25999,'256GB':28499,'512GB':33499,'1TB':38499},
        opciones:{ almacenamiento:['128GB','256GB','512GB','1TB'], color:['Negro','Blanco','Dorado','Azul'] },
        img:'images/16pro.png'
      },
      {
        id:'ip16promax', nombre:'iPhone 16 Pro Max',
        precioOriginal:{'256GB':30999,'512GB':35999,'1TB':40999},
        opciones:{ almacenamiento:['256GB','512GB','1TB'], color:['Negro','Blanco','Dorado','Azul','Rojo'] },
        img:'images/16promax.png'
      }
    ];

    /* ===== 工具函数 ===== */
    const money = n => CURRENCY + Math.round(n);
    const pct = Math.round((1 - DISCOUNT) * 100); // 15
    const qs = sel => document.querySelector(sel);

    /* ===== 倒计时（24h循环，防重叠） ===== */
    (function countdown(){
      const FINISH_MS = 24 * 60 * 60 * 1000;
      const key='deal_deadline';
      let end = Number(localStorage.getItem(key) || 0);
      const now = Date.now();
      if(!end || end < now){ end = now + FINISH_MS; localStorage.setItem(key, String(end)); }

      function tick(){
        const remain = Math.max(0, end - Date.now());
        const t = Math.floor(remain/1000);
        const h = String(Math.floor(t/3600)%24).padStart(2,'0');
        const m = String(Math.floor(t%3600/60)).padStart(2,'0');
        const s = String(t%60).padStart(2,'0');
        qs('#h').textContent=h; qs('#m').textContent=m; qs('#s').textContent=s;
        if(remain<=0){ end = Date.now()+FINISH_MS; localStorage.setItem(key, String(end)); }
      }
      setInterval(tick,1000); tick();
    })();

    /* ===== 渲染产品卡 ===== */
    const grid = document.getElementById('grid');
    const seleccion = {}; // 记录选择
    window.productos = productos; // 给跳转脚本读取
    window.seleccion = seleccion;

    function render(){
      grid.innerHTML = productos.map(p=>{
        const def = p.opciones.almacenamiento[0];
        const newPrice = Math.round(p.precioOriginal[def] * DISCOUNT);
        return `
        <article class="card" data-id="${p.id}">
          <div class="ph"><img loading="lazy" src="${p.img}" alt="${p.nombre}"></div>
          <div class="ct">
            <div class="ttl">${p.nombre}</div>
            <div class="muted">Ahorra ${pct}% hoy</div>
            <div class="price">
              <div class="p-new">${money(newPrice)}</div>
              <div class="p-old">${money(p.precioOriginal[def])}</div>
              <span class="badge">-${pct}%</span>
            </div>

            <div class="opt-label">Almacenamiento</div>
            <div class="opt-row">
              ${p.opciones.almacenamiento.map(opt=>`<button class="opt" data-id="${p.id}" data-tipo="storage" data-valor="${opt}">${opt}</button>`).join('')}
            </div>

            <div class="opt-label">Color</div>
            <div class="dots">
              ${p.opciones.color.map(c=>`<div class="dot" title="${c}" data-id="${p.id}" data-tipo="color" data-valor="${c}" data-color="${c}"></div>`).join('')}
            </div>

            <div class="actions">
              <button class="btn buy" data-buy="${p.id}" data-name="${p.nombre}">Comprar</button>
              <button class="btn ghost" data-contact="${p.id}" data-name="${p.nombre}">WhatsApp</button>
            </div>
          </div>
        </article>`;
      }).join('');

      // 选择交互
      grid.querySelectorAll('.opt,.dot').forEach(el=>{
        el.addEventListener('click', e=>{
          const t=e.currentTarget; const id=t.dataset.id; const tipo=t.dataset.tipo; const valor=t.dataset.valor;
          seleccion[id]=seleccion[id]||{};
          seleccion[id][tipo] = (seleccion[id][tipo]===valor)? null : valor;

          // UI 激活态
          const sel = t.classList.contains('dot')? '.dot' : '.opt';
          grid.querySelectorAll(`${sel}[data-id="${id}"][data-tipo="${tipo}"]`).forEach(x=>x.classList.remove('active'));
          if(seleccion[id][tipo]){
            grid.querySelector(`${sel}[data-id="${id}"][data-tipo="${tipo}"][data-valor="${valor}"]`)?.classList.add('active');
          }

          // 改容量 -> 实时改价
          if(tipo==='storage'){
            const p = productos.find(x=>x.id===id);
            if(p){
              const orig = p.precioOriginal[valor];
              const card = grid.querySelector(`.card[data-id="${id}"]`);
              const pn = card?.querySelector('.p-new'); const po = card?.querySelector('.p-old');
              if(typeof orig==='number' && pn && po){
                pn.textContent = money(Math.round(orig * DISCOUNT));
                po.textContent = money(orig);
              }
            }
          }
        });
      });

      // 购买：新标签打开支付页
      grid.querySelectorAll('[data-buy]').forEach(btn=>{
        btn.addEventListener('click', e=>{
          const id = btn.dataset.buy; const name = btn.dataset.name;
          const p = productos.find(x=>x.id===id);
          if(!p) return;
          let storage = seleccion[id]?.storage || p.opciones.almacenamiento[0];
          let color   = seleccion[id]?.color   || '';
          const price = Math.round(p.precioOriginal[storage] * DISCOUNT);

          // 更新“袋子”数量
          const bag = document.getElementById('bag');
          const cnt = Number(bag.getAttribute('data-count')||0)+1;
          bag.setAttribute('data-count', String(cnt));

          const picked = name + (storage?(' '+storage):'') + (color?(' '+color):'');
          const sp = new URLSearchParams({ product:picked, productId:id, storage, color, price:String(price) });
          const url = `${PAYMENT_URL}?${sp.toString()}`;
          const w = window.open(url, '_blank'); if(w){ try{ w.opener=null }catch(_){} }
        });
      });

      // 联系客服（带产品信息）
      grid.querySelectorAll('[data-contact]').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const id = btn.dataset.contact; const name = btn.dataset.name;
          const p = productos.find(x=>x.id===id);
          let storage = seleccion[id]?.storage || p.opciones.almacenamiento[0];
          let color   = seleccion[id]?.color   || '';
          const txt = encodeURIComponent(`Hola, quiero consultar ${name}${storage?(' '+storage):''}${color?(' '+color):''}.`);
          window.open(`${WHATSAPP_URL}?text=${txt}`,'_blank');
        });
      });
    }
    render();

    // 顶部按钮
    document.getElementById('btnTopWA').onclick = ()=> window.open(WHATSAPP_URL,'_blank');
    document.getElementById('btnBottomWA2').onclick = ()=> window.open(WHATSAPP_URL,'_blank');
    document.getElementById('btnWA').onclick = ()=> window.open(WHATSAPP_URL,'_blank');
    document.getElementById('btnShop').onclick = ()=> document.getElementById('grid').scrollIntoView({behavior:'smooth'});

    // 轻量 ticker（兼容你之前的 /api/feed，如果没有就静默）
    (async function loadFeed(){
      try{
        const r = await fetch('/api/feed',{cache:'no-store'});
        const {ok,items} = await r.json();
        if(!ok || !items) return;
        const txt = items.map(o=>{
          const when=(o.updatedAt||'').slice(5,16).replace(' ',' ');
          return `【${when}】${o.name} compró ${o.product}${o.color?('('+o.color+')'):''} ×${o.qty||1}`;
        }).join('　|　');
        const el = document.getElementById('tickerText'); el.textContent=txt||'Actualizaciones recientes';
        let off=0; setInterval(()=>{off=(off+1)%50000; el.style.transform=`translateX(${-off}px)`},30);
      }catch(e){}
    })();

    // 个人中心（如需接 /api/orders 可延续原逻辑，这里仅占位）
    document.getElementById('btnCentro').onclick = ()=> alert('Centro de pedidos próximamente.');
  </script>
</body>
</html>
